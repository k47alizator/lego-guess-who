<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO Guess Who</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --lego-red: #da291c; --lego-blue: #006cb7; --lego-yellow: #ffd500; --lego-white: #ffffff; }
        body { font-family: 'Arial Black', sans-serif; background: #e5e5e5; margin: 0; padding: 10px; text-align: center; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 20px; border-radius: 20px; border: 5px solid var(--lego-yellow); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .hidden { display: none !important; }
        .big-btn { width: 260px; padding: 18px; margin: 10px; font-size: 18px; border-radius: 12px; border: none; color: white; cursor: pointer; font-weight: bold; box-shadow: 0 5px 0 #000; transition: 0.1s; }
        .btn-blue { background: var(--lego-blue); }
        .btn-green { background: #28a745; }
        .big-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #000; }
        .board { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 20px; }
        .card { background: #fff; border: 3px solid #ddd; border-radius: 10px; padding: 8px; cursor: pointer; position: relative; transition: 0.2s; display: flex; flex-direction: column; align-items: center; }
        .card img { width: 100%; height: 110px; object-fit: contain; pointer-events: none; }
        .card p { margin: 5px 0; font-size: 12px; font-weight: bold; pointer-events: none; }
        .card.eliminated { opacity: 0.15; filter: grayscale(1); transform: scale(0.95); }
        .guess-btn { background: var(--lego-red); color: white; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 10px; font-weight: bold; margin-top: auto; }
        .game-header { background: var(--lego-yellow); padding: 15px; border-radius: 12px; display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; border: 3px solid #ccac00; }
        input { padding: 12px; font-size: 22px; border-radius: 8px; border: 3px solid var(--lego-blue); text-align: center; width: 150px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="color:var(--lego-red); -webkit-text-stroke: 1px black; margin:10px 0;">LEGO GUESS WHO</h1>

    <div id="s-start">
        <button class="big-btn btn-blue" onclick="goHost()">STWÓRZ POKÓJ</button><br>
        <button class="big-btn btn-green" onclick="showS('s-join')">DOŁĄCZ DO GRY</button>
    </div>

    <div id="s-join" class="hidden">
        <h3>Wpisz 4-cyfrowy kod od kolegi:</h3>
        <input type="text" id="join-id" maxlength="4" placeholder="0000"><br><br>
        <button class="big-btn btn-green" onclick="doJoin()">POŁĄCZ TERAZ</button>
        <p onclick="showS('s-start')" style="cursor:pointer; color:grey; text-decoration:underline;">Wróć do menu</p>
    </div>

    <div id="s-lobby" class="hidden">
        <p style="font-size: 18px;">TWÓJ KOD POKOJU:</p>
        <h2 id="my-id" style="font-size:50px; color:var(--lego-blue); margin:10px; letter-spacing: 5px;">----</h2>
        <p>Gdy kolega dołączy, wybierz kategorię:</p>
        <div id="cat-list" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;"></div>
    </div>

    <div id="s-game" class="hidden">
        <div class="game-header">
            <div>TWOJA POSTAĆ:<br><strong id="my-char-name" style="font-size:20px; color:var(--lego-red);">?</strong></div>
            <button onclick="location.reload()" style="background:#444; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Wyjdź z gry</button>
        </div>
        <div id="game-board" class="board"></div>
    </div>
</div>

<script>
    // --- KONFIGURACJA TWOJEGO KONTA ---
    const GITHUB_USER = "k47alizator"; 
    const REPO_NAME = "lego-guess-who"; 
    const IMG_BASE = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/img/`;

    // BAZA DANYCH (min. 24 postacie na kategorię)
    const db = {
        "STAR WARS": [
            {n:"Darth Vader", img:"vader.jpg"}, {n:"Yoda", img:"yoda.jpg"}, {n:"Luke", img:"luke.jpg"},
            {n:"R2D2", img:"r2d2.jpg"}, {n:"Chewbacca", img:"chewie.jpg"}, {n:"Han Solo", img:"han.jpg"},
            {n:"Leia", img:"leia.jpg"}, {n:"C3PO", img:"c3po.jpg"}, {n:"Boba Fett", img:"boba.jpg"},
            {n:"Stormtrooper", img:"storm.jpg"}, {n:"Kylo Ren", img:"kylo.jpg"}, {n:"Rey", img:"rey.jpg"},
            {n:"Maul", img:"maul.jpg"}, {n:"Ahsoka", img:"ahsoka.jpg"}, {n:"Obi-Wan", img:"obi.jpg"},
            {n:"Anakin", img:"anakin.jpg"}, {n:"Palpatine", img:"palp.jpg"}, {n:"Mando", img:"mando.jpg"},
            {n:"Grogu", img:"grogu.jpg"}, {n:"Admiral Ackbar", img:"ackbar.jpg"}, {n:"Lando", img:"lando.jpg"},
            {n:"Grievous", img:"grievous.jpg"}, {n:"Dooku", img:"dooku.jpg"}, {n:"Finn", img:"finn.jpg"}
        ],
        "BATMAN": [
            {n:"Batman", img:"batman.jpg"}, {n:"Joker", img:"joker.jpg"}, {n:"Robin", img:"robin.jpg"},
            {n:"Harley Quinn", img:"harley.jpg"}, {n:"Bane", img:"bane.jpg"}, {n:"Batgirl", img:"batgirl.jpg"},
            {n:"Two-Face", img:"twoface.jpg"}, {n:"Penguin", img:"penguin.jpg"}, {n:"Riddler", img:"riddler.jpg"},
            {n:"Catwoman", img:"catwoman.jpg"}, {n:"Poison Ivy", img:"ivy.jpg"}, {n:"Scarecrow", img:"scarecrow.jpg"},
            {n:"Nightwing", img:"nightwing.jpg"}, {n:"Alfred", img:"alfred.jpg"}, {n:"Commissioner Gordon", img:"gordon.jpg"},
            {n:"Ra's al Ghul", img:"ras.jpg"}, {n:"Killer Croc", img:"croc.jpg"}, {n:"Mr. Freeze", img:"freeze.jpg"},
            {n:"Batwoman", img:"batwoman.jpg"}, {n:"Red Hood", img:"redhood.jpg"}, {n:"Zatanna", img:"zatanna.jpg"},
            {n:"Clayface", img:"clayface.jpg"}, {n:"Hush", img:"hush.jpg"}, {n:"Bat-Mite", img:"batmite.jpg"}
        ]
    };

    let peer, conn, myChar, boardData, shortId;

    function showS(id) {
        ['s-start', 's-join', 's-lobby', 's-game'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    Object.keys(db).forEach(cat => {
        const b = document.createElement('button');
        b.className = 'big-btn btn-blue';
        b.style.width = "200px";
        b.innerText = cat;
        b.onclick = () => hStart(cat);
        document.getElementById('cat-list').appendChild(b);
    });

    function goHost() {
        showS('s-lobby');
        shortId = Math.floor(1000 + Math.random() * 9000).toString();
        peer = new Peer(shortId);
        
        peer.on('open', () => {
            document.getElementById('my-id').innerText = shortId;
        });

        peer.on('connection', c => { 
            conn = c; 
            alert("GRACZ DOŁĄCZYŁ!");
            setupConn();
        });

        peer.on('error', err => {
            if(err.type === 'unavailable-id') goHost();
        });
    }

    function doJoin() {
        const id = document.getElementById('join-id').value;
        peer = new Peer();
        peer.on('open', () => {
            conn = peer.connect(id);
            setupConn();
        });
    }

    function setupConn() {
        conn.on('data', data => {
            if(data.type === 'START') {
                boardData = data.pool;
                myChar = data.yourChar;
                renderGame();
            }
            if(data.type === 'GUESS') {
                if(confirm("Przeciwnik pyta czy masz: " + data.name + "?")) {
                    if(data.name === myChar.n) alert("PRZECIWNIK WYGRAŁ!");
                    else alert("PRZECIWNIK SIĘ POMYLIŁ!");
                }
            }
        });
    }

    function hStart(cat) {
        if(!conn) return alert("Czekaj na kolegę!");
        let pool = db[cat];
        let shuffled = pool.sort(() => 0.5 - Math.random()).slice(0, 24);
        
        const charForHost = shuffled[Math.floor(Math.random()*24)];
        const charForGuest = shuffled[Math.floor(Math.random()*24)];

        conn.send({ type: 'START', pool: shuffled, yourChar: charForHost });
        boardData = shuffled;
        myChar = charForGuest;
        renderGame();
    }

    function renderGame() {
        showS('s-game');
        document.getElementById('my-char-name').innerText = myChar.n;
        const b = document.getElementById('game-board');
        b.innerHTML = '';

        boardData.forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${IMG_BASE + p.img}" onerror="this.src='https://via.placeholder.com/150/ffd500/000000?text=LEGO'">
                <p>${p.n}</p>
                <button class="guess-btn" onclick="makeGuess('${p.n}', event)">ZGADUJ!</button>
            `;
            card.onclick = () => card.classList.toggle('eliminated');
            b.appendChild(card);
        });
    }

    function makeGuess(name, event) {
        event.stopPropagation();
        if(confirm("Czy chcesz zapytać czy przeciwnik to: " + name + "?")) {
            conn.send({type: 'GUESS', name: name});
            alert("Wysłano pytanie!");
        }
    }
</script>
</body>
</html>
