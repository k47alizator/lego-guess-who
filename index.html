<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO ZGADNIJ KTO TO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --lego-red: #da291c; --lego-blue: #006cb7; --lego-yellow: #ffd500; --lego-white: #ffffff; }
        body { font-family: 'Arial Black', sans-serif; background: #e5e5e5; margin: 0; padding: 10px; text-align: center; }
        
        /* Dynamiczny prze≈ÇƒÖcznik jƒôzyka */
        .lang-switcher { position: fixed; top: 15px; right: 15px; z-index: 2000; }
        .lang-toggle-btn { font-size: 35px; cursor: pointer; border: 3px solid var(--lego-blue); background: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; padding: 0; }
        .lang-toggle-btn:hover { transform: scale(1.1); }

        .container { max-width: 1200px; margin: 50px auto 0; background: white; padding: 20px; border-radius: 20px; border: 5px solid var(--lego-yellow); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; }
        .hidden { display: none !important; }
        
        .big-btn { width: 220px; padding: 15px; margin: 5px; font-size: 13px; border-radius: 10px; border: none; color: white; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #000; transition: 0.1s; text-transform: uppercase; }
        .btn-blue { background: var(--lego-blue); }
        .btn-green { background: #28a745; }
        .btn-red { background: var(--lego-red); }
        .btn-mixed { background: linear-gradient(45deg, #da291c, #006cb7, #ffd500); color: black !important; border: 2px solid black; }
        
        .board { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; margin-top: 20px; }
        .card { background: #fff; border: 3px solid #ddd; border-radius: 10px; padding: 8px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: 0.2s; }
        .card img { width: 100%; height: 130px; object-fit: contain; pointer-events: none; }
        .card p { margin: 8px 0; font-size: 12px; font-weight: bold; pointer-events: none; min-height: 35px; display: flex; align-items: center; justify-content: center; line-height: 1.2; }
        .card.eliminated { opacity: 0.15; filter: grayscale(1); transform: scale(0.92); }
        .guess-btn { background: var(--lego-red); color: white; border: none; padding: 6px; border-radius: 5px; cursor: pointer; font-size: 10px; font-weight: bold; width: 100%; }
        
        .game-header { background: var(--lego-yellow); padding: 15px; border-radius: 12px; display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; border: 3px solid #ccac00; }
        
        #result-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #result-card { background: white; padding: 30px; border-radius: 20px; color: black; text-align: center; }
        #result-img { width: 200px; height: 200px; object-fit: contain; }

        input { padding: 12px; font-size: 22px; border-radius: 8px; border: 3px solid var(--lego-blue); text-align: center; width: 220px; text-transform: uppercase; }
        #room-display { font-size: 40px; color: var(--lego-blue); background: #f0f0f0; padding: 10px 20px; border-radius: 10px; display: inline-block; margin: 10px 0; border: 2px dashed #ccc; font-weight: bold; }
        .back-link { margin-top: 20px; display: block; color: #666; cursor: pointer; text-decoration: underline; font-size: 14px; }
    </style>
</head>
<body>

<div class="lang-switcher">
    <button id="lang-toggle" class="lang-toggle-btn" onclick="toggleLanguage()">üá¨üáß</button>
</div>

<div class="container">
    <div id="s-main">
        <h1 id="txt-title" style="color:var(--lego-red); -webkit-text-stroke: 1px black;">LEGO ZGADNIJ KTO TO</h1>
        <button class="big-btn btn-blue" onclick="goHost()" id="txt-host">STW√ìRZ POK√ìJ</button><br>
        <button class="big-btn btn-green" onclick="showS('s-join')" id="txt-join">DO≈ÅƒÑCZ DO GRY</button>
    </div>

    <div id="s-join" class="hidden">
        <h3 id="txt-inputCode">Wpisz kod pokoju:</h3>
        <input type="text" id="join-id" placeholder="KOD..."><br><br>
        <button class="big-btn btn-green" onclick="doJoin()" id="txt-connect">PO≈ÅƒÑCZ</button>
        <span class="back-link" onclick="location.reload()" id="txt-back">Wstecz</span>
    </div>

    <div id="s-lobby" class="hidden">
        <p id="txt-yourCode">TW√ìJ KOD POKOJU:</p>
        <div id="room-display">...</div>
        <p id="wait-msg">Czekaj na kolegƒô...</p>
        <div id="cat-list" class="hidden" style="display:flex; flex-wrap:wrap; justify-content:center; gap:8px;"></div>
        <span class="back-link" onclick="location.reload()" id="txt-back2">WYJD≈π / POWR√ìT</span>
    </div>

    <div id="s-game" class="hidden">
        <div class="game-header">
            <div><span id="txt-youAre">TWOJA POSTAƒÜ:</span><br><strong id="my-char-name" style="font-size:18px; color:var(--lego-red);">?</strong></div>
            <button onclick="location.reload()" id="txt-exit" class="btn-red" style="width:100px; padding:10px; font-size:12px; box-shadow:none;">WYJD≈π</button>
        </div>
        <div id="game-board" class="board"></div>
    </div>
</div>

<div id="result-overlay" class="hidden">
    <h1 id="res-title" style="font-size: 60px; -webkit-text-stroke: 2px black;">WYNIK</h1>
    <div id="result-card">
        <p id="txt-was">To by≈Ç(a):</p>
        <h2 id="result-char-name">Postaƒá</h2>
        <img id="result-img" src="">
        <br><br>
        <button class="big-btn btn-blue" id="txt-replay" onclick="location.reload()">ZAGRAJ PONOWNIE</button>
    </div>
</div>

<script>
    const GITHUB_USER = "k47alizator"; 
    const REPO_NAME = "lego-guess-who"; 
    const IMG_BASE = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/img/`;

    const langData = {
        pl: { title: "LEGO ZGADNIJ KTO TO", host: "STW√ìRZ POK√ìJ", join: "DO≈ÅƒÑCZ DO GRY", inputCode: "Wpisz kod pokoju:", connect: "PO≈ÅƒÑCZ", yourCode: "TW√ìJ KOD POKOJU:", wait: "Czekaj na kolegƒô...", youAre: "TWOJA POSTAƒÜ:", exit: "WYJD≈π", guess: "ZGADUJ!", mixed: "‚≠ê WSZYSTKO MIESZANE ‚≠ê", win: "WYGRA≈ÅE≈ö!", lose: "PRZEGRA≈ÅE≈ö!", was: "To by≈Ç(a):", replay: "ZAGRAJ PONOWNIE", back: "Wstecz", back2: "POWR√ìT DO MENU", confirmG: "Czy na pewno zgadujesz: ", alertMiss: "Pud≈Ço! To nie ta postaƒá.", alertJoin: "Gracz do≈ÇƒÖczy≈Ç!", nextLang: "üá¨üáß" },
        en: { title: "LEGO GUESS WHO", host: "CREATE ROOM", join: "JOIN GAME", inputCode: "Enter room code:", connect: "CONNECT", yourCode: "YOUR ROOM CODE:", wait: "Waiting for player...", youAre: "YOUR CHARACTER:", exit: "EXIT", guess: "GUESS!", mixed: "‚≠ê ALL MIXED ‚≠ê", win: "YOU WIN!", lose: "YOU LOSE!", was: "It was:", replay: "PLAY AGAIN", back: "Back", back2: "BACK TO MENU", confirmG: "Are you sure you guess: ", alertMiss: "Miss! That's not the character.", alertJoin: "Player joined!", nextLang: "üáµüá±" }
    };
    
    let curL = 'pl';
    let peer, conn, myChar, boardData, isHost = false;

    // Baza postaci (fragment)
    const db = {
        "STAR WARS": [{n:"Darth Vader", img:"vader.jpg"}, {n:"Mistrz Yoda", img:"yoda.jpg"}, {n:"Luke Skywalker", img:"luke.jpg"}, {n:"R2-D2", img:"r2d2.jpg"}, {n:"Chewbacca", img:"chewie.jpg"}, {n:"Han Solo", img:"han.jpg"}, {n:"Ksiƒô≈ºniczka Leia", img:"leia.jpg"}, {n:"C-3PO", img:"c3po.jpg"}, {n:"Boba Fett", img:"boba.jpg"}, {n:"Szturmowiec Imperium", img:"storm.jpg"}],
        "MARVEL": [{n:"Iron Man (Tony Stark)", img:"ironman.jpg"}, {n:"Spider-Man (Peter Parker)", img:"spiderman.jpg"}, {n:"Kapitan Ameryka", img:"cap.jpg"}, {n:"Thor Odinson", img:"thor.jpg"}, {n:"Hulk (Bruce Banner)", img:"hulk.jpg"}, {n:"Czarna Wdowa", img:"widow.jpg"}, {n:"Thanos", img:"thanos.jpg"}, {n:"Doktor Strange", img:"strange.jpg"}],
        "HARRY POTTER": [{n:"Harry Potter", img:"harry.jpg"}, {n:"Ron Weasley", img:"ron.jpg"}, {n:"Hermiona Granger", img:"hermiona.jpg"}, {n:"Albus Dumbledore", img:"dumbledore.jpg"}, {n:"Lord Voldemort", img:"voldemort.jpg"}, {n:"Severus Snape", img:"snape.jpg"}, {n:"Rubeus Hagrid", img:"hagrid.jpg"}, {n:"Draco Malfoy", img:"draco.jpg"}]
    };

    function toggleLanguage() {
        curL = (curL === 'pl') ? 'en' : 'pl';
        updateUI();
    }

    function updateUI() {
        const L = langData[curL];
        document.getElementById('lang-toggle').innerText = L.nextLang;
        document.getElementById('txt-title').innerText = L.title;
        document.getElementById('txt-host').innerText = L.host;
        document.getElementById('txt-join').innerText = L.join;
        document.getElementById('txt-inputCode').innerText = L.inputCode;
        document.getElementById('txt-connect').innerText = L.connect;
        document.getElementById('txt-back').innerText = L.back;
        document.getElementById('txt-back2').innerText = L.back2;
        document.getElementById('txt-yourCode').innerText = L.yourCode;
        document.getElementById('txt-youAre').innerText = L.youAre;
        document.getElementById('txt-exit').innerText = L.exit;
        document.getElementById('txt-was').innerText = L.was;
        document.getElementById('txt-replay').innerText = L.replay;
        
        if(isHost && !document.getElementById('cat-list').classList.contains('hidden')) renderCatList();
        document.querySelectorAll('.guess-btn').forEach(btn => btn.innerText = L.guess);
    }

    function showS(id) {
        ['s-main', 's-join', 's-lobby', 's-game'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function goHost() {
        isHost = true;
        showS('s-lobby');
        const sid = Math.random().toString(36).substring(2, 8).toUpperCase();
        document.getElementById('room-display').innerText = sid;
        peer = new Peer(sid);
        peer.on('connection', c => {
            conn = c;
            document.getElementById('wait-msg').innerText = langData[curL].alertJoin;
            document.getElementById('cat-list').classList.remove('hidden');
            renderCatList();
            setupConn();
        });
    }

    function renderCatList() {
        const list = document.getElementById('cat-list');
        list.innerHTML = `<button class="big-btn btn-mixed" onclick="hStart('MIXED')">${langData[curL].mixed}</button>`;
        Object.keys(db).forEach(cat => {
            const b = document.createElement('button');
            b.className = 'big-btn btn-blue';
            b.innerText = cat;
            b.onclick = () => hStart(cat);
            list.appendChild(b);
        });
    }

    function doJoin() {
        const id = document.getElementById('join-id').value.toUpperCase();
        if(!id) return;
        peer = new Peer();
        peer.on('open', () => {
            conn = peer.connect(id);
            setupConn();
        });
    }

    function setupConn() {
        conn.on('data', data => {
            if(data.type === 'START') { boardData = data.pool; myChar = data.yourChar; renderGame(); }
            if(data.type === 'GUESS') {
                if(confirm((curL === 'pl' ? "Czy Twoja postaƒá to: " : "Is your character: ") + data.name + "?")) {
                    if(data.name === myChar.n) {
                        conn.send({type: 'RESULT', status: 'WIN', char: myChar});
                        showFinalResult('LOSE', myChar);
                    } else alert(langData[curL].alertMiss);
                }
            }
            if(data.type === 'RESULT') showFinalResult(data.status, data.char);
        });
    }

    function hStart(cat) {
        let pool = [];
        if(cat === 'MIXED') Object.values(db).forEach(v => pool = pool.concat(v));
        else pool = db[cat];
        let shuffled = pool.sort(() => 0.5 - Math.random()).slice(0, 30);
        const hChar = shuffled[Math.floor(Math.random()*30)];
        const gChar = shuffled[Math.floor(Math.random()*30)];
        conn.send({ type: 'START', pool: shuffled, yourChar: hChar });
        boardData = shuffled; myChar = gChar; renderGame();
    }

    function renderGame() {
        showS('s-game');
        document.getElementById('my-char-name').innerText = myChar.n;
        const b = document.getElementById('game-board');
        b.innerHTML = '';
        boardData.forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<img src="${IMG_BASE + p.img}" onerror="this.src='https://via.placeholder.com/150/ffd500/000000?text=LEGO'"><p>${p.n}</p><button class="guess-btn" onclick="makeGuess('${p.n}', event)">${langData[curL].guess}</button>`;
            card.onclick = () => card.classList.toggle('eliminated');
            b.appendChild(card);
        });
    }

    function makeGuess(name, event) {
        event.stopPropagation();
        if(confirm(langData[curL].confirmG + name + "?")) conn.send({type: 'GUESS', name: name});
    }

    function showFinalResult(status, character) {
        const overlay = document.getElementById('result-overlay');
        overlay.classList.remove('hidden');
        document.getElementById('res-title').innerText = status === 'WIN' ? langData[curL].win : langData[curL].lose;
        document.getElementById('res-title').style.color = status === 'WIN' ? "#28a745" : "#da291c";
        document.getElementById('result-char-name').innerText = character.n;
        document.getElementById('result-img').src = IMG_BASE + character.img;
    }
    
    // Inicjalizacja napis√≥w
    updateUI();
</script>
</body>
</html>
