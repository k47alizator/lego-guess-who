<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO ZGADNIJ KTO TO - FULL VERSION</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --lego-red: #da291c; --lego-blue: #006cb7; --lego-yellow: #ffd500; --lego-white: #ffffff; }
        body { font-family: 'Arial Black', sans-serif; background: #e5e5e5; margin: 0; padding: 10px; text-align: center; }
        
        /* Dynamiczny prze≈ÇƒÖcznik jƒôzyka */
        .lang-switcher { position: fixed; top: 15px; right: 15px; z-index: 2000; }
        .lang-toggle-btn { font-size: 35px; cursor: pointer; border: 3px solid var(--lego-blue); background: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; }

        .container { max-width: 1200px; margin: 50px auto 0; background: white; padding: 20px; border-radius: 20px; border: 5px solid var(--lego-yellow); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; min-height: 80vh; }
        .hidden { display: none !important; }
        
        .big-btn { width: 240px; padding: 15px; margin: 8px; font-size: 13px; border-radius: 10px; border: none; color: white; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #000; transition: 0.1s; text-transform: uppercase; }
        .btn-blue { background: var(--lego-blue); }
        .btn-green { background: #28a745; }
        .btn-red { background: var(--lego-red); }
        .btn-mixed { background: linear-gradient(45deg, #da291c, #006cb7, #ffd500); color: black !important; border: 2px solid black; }
        
        /* Kafelki postaci */
        .board { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: #fff; border: 3px solid #ddd; border-radius: 10px; padding: 10px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: 0.2s; position: relative; }
        .card img { width: 100%; height: 140px; object-fit: contain; pointer-events: none; }
        .card p { margin: 10px 0; font-size: 13px; font-weight: bold; pointer-events: none; min-height: 40px; display: flex; align-items: center; justify-content: center; line-height: 1.2; }
        .card.eliminated { opacity: 0.2; filter: grayscale(1); transform: scale(0.95); }
        
        .guess-btn { background: var(--lego-red); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; font-size: 11px; font-weight: bold; width: 100%; margin-top: auto; }
        
        .game-header { background: var(--lego-yellow); padding: 15px; border-radius: 12px; display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; border: 3px solid #ccac00; }
        
        /* Overlay Wyniku */
        #result-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #result-card { background: white; padding: 40px; border-radius: 20px; color: black; text-align: center; max-width: 400px; }
        #result-img { width: 220px; height: 220px; object-fit: contain; margin: 20px 0; }

        input { padding: 15px; font-size: 24px; border-radius: 10px; border: 4px solid var(--lego-blue); text-align: center; width: 250px; text-transform: uppercase; }
        #room-display { font-size: 45px; color: var(--lego-blue); background: #f0f0f0; padding: 15px 30px; border-radius: 15px; display: inline-block; margin: 15px 0; border: 3px dashed #bbb; font-weight: bold; letter-spacing: 5px; }
        .back-link { margin-top: 30px; display: inline-block; color: #444; cursor: pointer; font-weight: bold; text-decoration: underline; font-size: 16px; padding: 10px; }
    </style>
</head>
<body>

<div class="lang-switcher">
    <button id="lang-toggle" class="lang-toggle-btn" onclick="toggleLanguage()">üá¨üáß</button>
</div>

<div class="container">
    <div id="s-main">
        <h1 id="txt-title" style="color:var(--lego-red); font-size: 40px; -webkit-text-stroke: 1.5px black; margin-bottom: 40px;">LEGO ZGADNIJ KTO TO</h1>
        <button class="big-btn btn-blue" onclick="goHost()" id="txt-host">STW√ìRZ POK√ìJ</button><br>
        <button class="big-btn btn-green" onclick="showS('s-join')" id="txt-join">DO≈ÅƒÑCZ DO GRY</button>
    </div>

    <div id="s-join" class="hidden">
        <h3 id="txt-inputCode">Wpisz kod pokoju:</h3>
        <input type="text" id="join-id" placeholder="..." maxlength="6"><br><br>
        <button class="big-btn btn-green" onclick="doJoin()" id="txt-connect">PO≈ÅƒÑCZ</button><br>
        <span class="back-link" onclick="location.reload()" id="txt-back">Wstecz / Back</span>
    </div>

    <div id="s-lobby" class="hidden">
        <p id="txt-yourCode">TW√ìJ KOD POKOJU:</p>
        <div id="room-display">...</div>
        <p id="wait-msg" style="font-size: 18px; color: #555;">Czekaj na kolegƒô...</p>
        <div id="cat-list" class="hidden" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px; max-width: 900px; margin: 20px auto;"></div>
        <span class="back-link" onclick="location.reload()" id="txt-back2">POWR√ìT / EXIT</span>
    </div>

    <div id="s-game" class="hidden">
        <div class="game-header">
            <div><span id="txt-youAre" style="font-size: 14px; opacity: 0.8;">TWOJA POSTAƒÜ:</span><br><strong id="my-char-name" style="font-size:22px; color:var(--lego-red);">?</strong></div>
            <button onclick="location.reload()" id="txt-exit" class="btn-red" style="width:100px; padding:10px; font-size:12px; box-shadow:none; margin:0;">WYJD≈π</button>
        </div>
        <div id="game-board" class="board"></div>
    </div>
</div>

<div id="result-overlay" class="hidden">
    <h1 id="res-title" style="font-size: 70px; -webkit-text-stroke: 2px black;">WYNIK</h1>
    <div id="result-card">
        <p id="txt-was" style="font-size: 20px; margin: 0;">To by≈Ç(a):</p>
        <h2 id="result-char-name" style="font-size: 30px; margin: 10px 0; color: var(--lego-blue);">Postaƒá</h2>
        <img id="result-img" src="" onerror="this.src='https://via.placeholder.com/200?text=LEGO'">
        <br>
        <button class="big-btn btn-blue" id="txt-replay" onclick="location.reload()" style="width: 100%;">ZAGRAJ PONOWNIE</button>
    </div>
</div>

<script>
    const GITHUB_USER = "k47alizator"; 
    const REPO_NAME = "lego-guess-who"; 
    const IMG_BASE = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/img/`;

    const langData = {
        pl: { title: "LEGO ZGADNIJ KTO TO", host: "STW√ìRZ POK√ìJ", join: "DO≈ÅƒÑCZ DO GRY", inputCode: "Wpisz kod pokoju:", connect: "PO≈ÅƒÑCZ", yourCode: "TW√ìJ KOD POKOJU:", wait: "Gracz do≈ÇƒÖczy≈Ç! Wybierz kategoriƒô:", youAre: "TWOJA POSTAƒÜ:", exit: "WYJD≈π", guess: "ZGADUJ!", mixed: "‚≠ê WSZYSTKO MIESZANE ‚≠ê", win: "WYGRA≈ÅE≈ö!", lose: "PRZEGRA≈ÅE≈ö!", was: "To by≈Ç(a):", replay: "ZAGRAJ PONOWNIE", back: "Wstecz", back2: "POWR√ìT DO MENU", confirmG: "Czy na pewno zgadujesz: ", alertMiss: "Pud≈Ço! To nie ta postaƒá.", alertWait: "Czekaj na po≈ÇƒÖczenie...", nextLang: "üá¨üáß" },
        en: { title: "LEGO GUESS WHO", host: "CREATE ROOM", join: "JOIN GAME", inputCode: "Enter room code:", connect: "CONNECT", yourCode: "YOUR ROOM CODE:", wait: "Player joined! Pick category:", youAre: "YOUR CHARACTER:", exit: "EXIT", guess: "GUESS!", mixed: "‚≠ê ALL MIXED ‚≠ê", win: "YOU WIN!", lose: "YOU LOSE!", was: "It was:", replay: "PLAY AGAIN", back: "Back", back2: "BACK TO MENU", confirmG: "Are you sure you guess: ", alertMiss: "Miss! That's not the character.", alertWait: "Waiting for connection...", nextLang: "üáµüá±" }
    };
    
    let curL = 'pl';
    let peer, conn, myChar, boardData, isHost = false;

    // --- PE≈ÅNA BAZA 14 KATEGORII ---
    const db = {
        "STAR WARS": [
            {n:"Darth Vader", img:"vader.jpg"}, {n:"Mistrz Yoda", img:"yoda.jpg"}, {n:"Luke Skywalker", img:"luke.jpg"}, {n:"R2-D2", img:"r2d2.jpg"}, {n:"Chewbacca", img:"chewie.jpg"}, {n:"Han Solo", img:"han.jpg"}, {n:"Ksiƒô≈ºniczka Leia", img:"leia.jpg"}, {n:"C-3PO", img:"c3po.jpg"}, {n:"Boba Fett", img:"boba.jpg"}, {n:"Szturmowiec", img:"storm.jpg"}, {n:"Kylo Ren", img:"kylo.jpg"}, {n:"Rey Skywalker", img:"rey.jpg"}, {n:"Darth Maul", img:"maul.jpg"}, {n:"Ahsoka Tano", img:"ahsoka.jpg"}, {n:"Obi-Wan Kenobi", img:"obi.jpg"}, {n:"Anakin Skywalker", img:"anakin.jpg"}, {n:"Imperator Palpatine", img:"palp.jpg"}, {n:"Din Djarin (Mando)", img:"mando.jpg"}, {n:"Grogu", img:"grogu.jpg"}, {n:"Admira≈Ç Ackbar", img:"ackbar.jpg"}, {n:"Genera≈Ç Grievous", img:"grievous.jpg"}, {n:"Hrabia Dooku", img:"dooku.jpg"}, {n:"Lando Calrissian", img:"lando.jpg"}, {n:"Mace Windu", img:"windu.jpg"}, {n:"Kit Fisto", img:"kit.jpg"}, {n:"Jabba the Hutt", img:"jabba.jpg"}, {n:"Qui-Gon Jinn", img:"quigon.jpg"}, {n:"Jango Fett", img:"jango.jpg"}, {n:"Poe Dameron", img:"poe.jpg"}, {n:"Wicket", img:"wicket.jpg"}
        ],
        "MARVEL": [
            {n:"Iron Man", img:"ironman.jpg"}, {n:"Spider-Man", img:"spiderman.jpg"}, {n:"Kapitan Ameryka", img:"cap.jpg"}, {n:"Thor Odinson", img:"thor.jpg"}, {n:"Hulk", img:"hulk.jpg"}, {n:"Czarna Wdowa", img:"widow.jpg"}, {n:"Thanos", img:"thanos.jpg"}, {n:"Czarna Pantera", img:"panther.jpg"}, {n:"Doktor Strange", img:"strange.jpg"}, {n:"Groot", img:"groot.jpg"}, {n:"Rocket Raccoon", img:"rocket.jpg"}, {n:"Ant-Man", img:"antman.jpg"}, {n:"Wolverine", img:"wolvie.jpg"}, {n:"Deadpool", img:"deadpool.jpg"}, {n:"Venom", img:"venom.jpg"}, {n:"Loki", img:"loki.jpg"}, {n:"Daredevil", img:"daredevil.jpg"}, {n:"Magneto", img:"magneto.jpg"}, {n:"Scarlet Witch", img:"witch.jpg"}, {n:"Star-Lord", img:"starlord.jpg"}, {n:"Nick Fury", img:"fury.jpg"}, {n:"Vision", img:"vision.jpg"}, {n:"Hawkeye", img:"hawkeye.jpg"}, {n:"Zimowy ≈ªo≈Çnierz", img:"bucky.jpg"}, {n:"Falcon", img:"falcon.jpg"}, {n:"Gamora", img:"gamora.jpg"}, {n:"Drax", img:"drax.jpg"}, {n:"Punisher", img:"punisher.jpg"}, {n:"Carnage", img:"carnage.jpg"}, {n:"Ghost Rider", img:"ghost.jpg"}
        ],
        "BATMAN / DC": [
            {n:"Batman", img:"batman.jpg"}, {n:"Joker", img:"joker.jpg"}, {n:"Robin", img:"robin.jpg"}, {n:"Harley Quinn", img:"harley.jpg"}, {n:"Bane", img:"bane.jpg"}, {n:"Batgirl", img:"batgirl.jpg"}, {n:"Dwie Twarze", img:"twoface.jpg"}, {n:"Pingwin", img:"penguin.jpg"}, {n:"Cz≈Çowiek Zagadka", img:"riddler.jpg"}, {n:"Kobieta Kot", img:"catwoman.jpg"}, {n:"TrujƒÖcy Bluszcz", img:"ivy.jpg"}, {n:"Strach na Wr√≥ble", img:"scarecrow.jpg"}, {n:"Superman", img:"superman.jpg"}, {n:"Wonder Woman", img:"ww.jpg"}, {n:"Flash", img:"flash.jpg"}, {n:"Aquaman", img:"aquaman.jpg"}, {n:"Lex Luthor", img:"luthor.jpg"}, {n:"Nightwing", img:"nightwing.jpg"}, {n:"Alfred Pennyworth", img:"alfred.jpg"}, {n:"Komisarz Gordon", img:"gordon.jpg"}, {n:"Killer Croc", img:"croc.jpg"}, {n:"Mr. Freeze", img:"freeze.jpg"}, {n:"Zatanna", img:"zatanna.jpg"}, {n:"Darkseid", img:"darkseid.jpg"}, {n:"Brainiac", img:"brainiac.jpg"}, {n:"Cyborg", img:"cyborg.jpg"}, {n:"Green Lantern", img:"gl.jpg"}, {n:"Shazam", img:"shazam.jpg"}, {n:"Black Adam", img:"blackadam.jpg"}, {n:"Doomsday", img:"doomsday.jpg"}
        ],
        "HARRY POTTER": [
            {n:"Harry Potter", img:"harry.jpg"}, {n:"Ron Weasley", img:"ron.jpg"}, {n:"Hermiona Granger", img:"hermiona.jpg"}, {n:"Albus Dumbledore", img:"dumbledore.jpg"}, {n:"Lord Voldemort", img:"voldemort.jpg"}, {n:"Severus Snape", img:"snape.jpg"}, {n:"Rubeus Hagrid", img:"hagrid.jpg"}, {n:"Draco Malfoy", img:"draco.jpg"}, {n:"Zgredek", img:"dobby.jpg"}, {n:"Bellatrix Lestrange", img:"bellatrix.jpg"}, {n:"Sirius Black", img:"sirius.jpg"}, {n:"Luna Lovegood", img:"luna.jpg"}, {n:"Neville Longbottom", img:"neville.jpg"}, {n:"Ginny Weasley", img:"ginny.jpg"}, {n:"Remus Lupin", img:"lupin.jpg"}, {n:"Minerwa McGonagall", img:"mcgonagall.jpg"}, {n:"Alastor Moody", img:"madeye.jpg"}, {n:"Cedrik Diggory", img:"cedric.jpg"}, {n:"Lucius Malfoy", img:"lucius.jpg"}, {n:"Cho Chang", img:"cho.jpg"}, {n:"Fred Weasley", img:"fred.jpg"}, {n:"George Weasley", img:"george.jpg"}, {n:"Dolores Umbridge", img:"umbridge.jpg"}, {n:"Viktor Krum", img:"krum.jpg"}, {n:"Fleur Delacour", img:"fleur.jpg"}, {n:"Argus Filch", img:"filch.jpg"}, {n:"Gilderoy Lockhart", img:"gilderoy.jpg"}, {n:"Narcyza Malfoy", img:"narcissa.jpg"}, {n:"Sybiila Trelawney", img:"trelawney.jpg"}, {n:"James Potter", img:"james.jpg"}
        ],
        "NINJAGO": [
            {n:"Kai", img:"kai.jpg"}, {n:"Jay", img:"jay.jpg"}, {n:"Zane", img:"zane.jpg"}, {n:"Cole", img:"cole.jpg"}, {n:"Lloyd", img:"lloyd.jpg"}, {n:"Nya", img:"nya.jpg"}, {n:"Mistrz Wu", img:"wu.jpg"}, {n:"Lord Garmadon", img:"garmadon.jpg"}, {n:"Pythor", img:"pythor.jpg"}, {n:"Dareth", img:"dareth.jpg"}, {n:"Skylor", img:"skylor.jpg"}, {n:"Morro", img:"morro.jpg"}, {n:"Mistrz Chen", img:"chen.jpg"}, {n:"Nadakhan", img:"nadakhan.jpg"}, {n:"Harumi", img:"harumi.jpg"}, {n:"Piksel", img:"pixal.jpg"}, {n:"Misako", img:"misako.jpg"}, {n:"Kryptor", img:"kryptor.jpg"}, {n:"Mindroid", img:"mindroid.jpg"}, {n:"Overlord", img:"overlord.jpg"}, {n:"Samuraj X", img:"samuraix.jpg"}, {n:"Aspheera", img:"aspheera.jpg"}, {n:"Vangelis", img:"vangelis.jpg"}, {n:"Unagami", img:"unagami.jpg"}, {n:"Kalmaar", img:"kalmaar.jpg"}, {n:"Mr. E", img:"mre.jpg"}, {n:"General Kozu", img:"kozu.jpg"}, {n:"Killow", img:"killow.jpg"}, {n:"Ultra Violet", img:"uv.jpg"}, {n:"Borg", img:"borg.jpg"}
        ],
        "CITY": [
            {n:"Policjant Chase", img:"chase.jpg"}, {n:"Z≈Çodziej Rex", img:"rex.jpg"}, {n:"Stra≈ºak Tom", img:"straza.jpg"}, {n:"Pilot Helikoptera", img:"pilot.jpg"}, {n:"Nurek", img:"nurek.jpg"}, {n:"Robotnik drogowy", img:"budowa.jpg"}, {n:"≈ömieciarz", img:"smieciarz.jpg"}, {n:"Lekarz Pogotowia", img:"lekarz.jpg"}, {n:"Pani Burmistrz", img:"mayor.jpg"}, {n:"Dziennikarka", img:"press.jpg"}, {n:"Astronauta", img:"astro.jpg"}, {n:"Rowerzysta", img:"rower.jpg"}, {n:"Kucharz Pizzy", img:"pizza.jpg"}, {n:"Listonosz", img:"poczta.jpg"}, {n:"Mechanik", img:"mechanik.jpg"}, {n:"Pasa≈ºer PociƒÖgu", img:"pasazer.jpg"}, {n:"Turysta", img:"turysta.jpg"}, {n:"Rybak", img:"rybak.jpg"}, {n:"Ratownik", img:"ratownik.jpg"}, {n:"Narciarz", img:"narciarz.jpg"}, {n:"Skater", img:"skater.jpg"}, {n:"Kierowca Autobusu", img:"autobus.jpg"}, {n:"Pani Naukowiec", img:"nauka.jpg"}, {n:"G√≥rnik", img:"gornik.jpg"}, {n:"Le≈õniczy", img:"las.jpg"}, {n:"Z≈Çodziejka", img:"zlodziejka.jpg"}, {n:"Kapitan Statku", img:"statek.jpg"}, {n:"Hokeista", img:"hokej.jpg"}, {n:"P≈Çywak", img:"plywak.jpg"}, {n:"Fotograf", img:"foto.jpg"}
        ],
        "CASTLE / RYCERSKA": [
            {n:"Kr√≥l", img:"krol.jpg"}, {n:"Kr√≥lowa", img:"krolowa.jpg"}, {n:"Czarny Rycerz", img:"brycerz.jpg"}, {n:"Bia≈Çy Rycerz", img:"wrycerz.jpg"}, {n:"Czarodziej", img:"wizard.jpg"}, {n:"Smok", img:"smok.jpg"}, {n:"Szkielet", img:"szkielet.jpg"}, {n:"B≈Çazen", img:"blazen.jpg"}, {n:"≈Åucznik", img:"lucznik.jpg"}, {n:"Kowal", img:"kowal.jpg"}, {n:"Ksiƒô≈ºniczka", img:"princess.jpg"}, {n:"Duch", img:"duch.jpg"}, {n:"Troll", img:"troll.jpg"}, {n:"Ork", img:"ork.jpg"}, {n:"Rycerz Lwa", img:"lew.jpg"}, {n:"Rycerz Soko≈Ça", img:"sokol.jpg"}, {n:"Giermek", img:"giermek.jpg"}, {n:"Bart≈Çomiej", img:"bart.jpg"}, {n:"Pustelnik", img:"pustelnik.jpg"}, {n:"Stra≈ºnik Wie≈ºy", img:"straznik.jpg"}, {n:"Krasnolud", img:"krasnal.jpg"}, {n:"Wied≈∫ma", img:"wiedzma.jpg"}, {n:"Goblina", img:"goblin.jpg"}, {n:"Zab√≥jca Smok√≥w", img:"slayer.jpg"}, {n:"Herold", img:"herold.jpg"}, {n:"Karczmarz", img:"karczmarz.jpg"}, {n:"Mieszczanin", img:"mieszczanin.jpg"}, {n:"Zbrojmistrz", img:"zbroja.jpg"}, {n:"Wiƒôzie≈Ñ", img:"wiezien.jpg"}, {n:"Szlachcic", img:"szlachcic.jpg"}
        ],
        "PIRATES / PIRACI": [
            {n:"Kapitan Rudobrody", img:"beard.jpg"}, {n:"Bosman", img:"bosman.jpg"}, {n:"Marynarz", img:"marynarz.jpg"}, {n:"Admira≈Ç", img:"admiral.jpg"}, {n:"Gubernator", img:"gubernator.jpg"}, {n:"C√≥rka Gubernatora", img:"corka.jpg"}, {n:"Pirat z OpaskƒÖ", img:"opaska.jpg"}, {n:"Pirat z DrewnianƒÖ NogƒÖ", img:"noga.jpg"}, {n:"Papuga", img:"papuga.jpg"}, {n:"Ma≈Çpka", img:"malpa.jpg"}, {n:"≈ªo≈Çnierz", img:"zolnierz.jpg"}, {n:"Pani Kapitan", img:"pkapitan.jpg"}, {n:"Rozbitek", img:"rozbitek.jpg"}, {n:"Kanibal", img:"kanibal.jpg"}, {n:"Kucharz okrƒôtowy", img:"kucharz.jpg"}, {n:"Szkielet Pirata", img:"pszkielet.jpg"}, {n:"Pirat z Hakem", img:"hak.jpg"}, {n:"Syrena", img:"syrena.jpg"}, {n:"Oficer Kr√≥lewski", img:"oficer.jpg"}, {n:"Rekin", img:"rekin.jpg"}, {n:"Korsarz", img:"korsarz.jpg"}, {n:"Handlarz", img:"handlarz.jpg"}, {n:"Stra≈ºnik Portu", img:"port.jpg"}, {n:"Zwiadowca", img:"zwiadowca.jpg"}, {n:"Pirat Muzyk", img:"muzyk.jpg"}, {n:"Dzia≈Çonowy", img:"dzialo.jpg"}, {n:"Bukanier", img:"bukanier.jpg"}, {n:"Szuler", img:"szuler.jpg"}, {n:"Legionista", img:"legion.jpg"}, {n:"Wiƒôzie≈Ñ Fortu", img:"fort.jpg"}
        ],
        "SPACE / KOSMOS": [{n:"Classic Space Blue", img:"sblue.jpg"}, {n:"Classic Space Red", img:"sred.jpg"}, {n:"Classic Space White", img:"swhite.jpg"}, {n:"Classic Space Yellow", img:"syellow.jpg"}, {n:"Blacktron Pilot", img:"blacktron.jpg"}, {n:"M-Tron Engineer", img:"mtron.jpg"}, {n:"Space Police", img:"spolice.jpg"}, {n:"Ice Planet Explorer", img:"iceplanet.jpg"}, {n:"Alien Lifeform", img:"alien.jpg"}, {n:"Robot Helper", img:"helper.jpg"}, {n:"Galaxy Commander", img:"gcommander.jpg"}, {n:"Unitron Pilot", img:"unitron.jpg"}, {n:"Explorien", img:"explorien.jpg"}, {n:"Insectoid", img:"insectoid.jpg"}, {n:"Life on Mars Alien", img:"mars.jpg"}, {n:"UFO Pilot", img:"ufo.jpg"}, {n:"Star Justice", img:"justice.jpg"}, {n:"Alien Villain", img:"villain.jpg"}, {n:"Cyborg Astronaut", img:"castro.jpg"}, {n:"Moon Miner", img:"miner.jpg"}, {n:"Solar Explorer", img:"solar.jpg"}, {n:"Deep Space Pilot", img:"deep.jpg"}, {n:"Nova Ranger", img:"nova.jpg"}, {n:"Cosmic Queen", img:"cqueen.jpg"}, {n:"Droid Pilot", img:"dpilot.jpg"}, {n:"Nebula Traveler", img:"nebula.jpg"}, {n:"Void Scout", img:"void.jpg"}, {n:"Ranger 7", img:"r7.jpg"}, {n:"Mecha Pilot", img:"mecha.jpg"}, {n:"Warp Driver", img:"warp.jpg"}],
        "TECHNIC": [{n:"Kierowca Wy≈õcigowy", img:"tdrive.jpg"}, {n:"In≈ºynier", img:"eng.jpg"}, {n:"Mechanik Technic", img:"tmech.jpg"}, {n:"Kierowca Ciƒô≈ºar√≥wki", img:"truck.jpg"}, {n:"Operator Koparki", img:"dig.jpg"}, {n:"Pilot Odrzutowca", img:"jet.jpg"}, {n:"Kaskader", img:"stunt.jpg"}, {n:"Tester Bolid√≥w", img:"test.jpg"}, {n:"Sƒôdzia Wy≈õcigowy", img:"sedzia.jpg"}, {n:"Kierowca Traktora", img:"traktor.jpg"}, {n:"Operator ≈ªurawia", img:"zuraw.jpg"}, {n:"Kierowca Quada", img:"quad.jpg"}, {n:"Motocyklista", img:"moto.jpg"}, {n:"Kierowca Buggy", img:"buggy.jpg"}, {n:"Pilot ≈ömig≈Çowca", img:"heli.jpg"}, {n:"Mechanik Pit-Stop", img:"pit.jpg"}, {n:"Ratownik Technic", img:"trescue.jpg"}, {n:"Kierowca Monster Trucka", img:"monster.jpg"}, {n:"Logistyk", img:"log.jpg"}, {n:"Kierowca Lawety", img:"laweta.jpg"}, {n:"Marynarz Technic", img:"sailor.jpg"}, {n:"Ekspert Hydrauliki", img:"hydro.jpg"}, {n:"Specjalista Pneumatyki", img:"pneu.jpg"}, {n:"Konstruktor", img:"konst.jpg"}, {n:"Kierowca Rally", img:"rally.jpg"}, {n:"Projektant", img:"proj.jpg"}, {n:"Kierowca Gokarta", img:"gokart.jpg"}, {n:"G≈Ç√≥wny Mechanik", img:"head.jpg"}, {n:"Zastƒôpca", img:"dep.jpg"}, {n:"Praktykant", img:"intern.jpg"}],
        "FRIENDS": [{n:"Olivia", img:"olivia.jpg"}, {n:"Mia", img:"mia.jpg"}, {n:"Stephanie", img:"steph.jpg"}, {n:"Emma", img:"emma.jpg"}, {n:"Andrea", img:"andrea.jpg"}, {n:"Livi", img:"livi.jpg"}, {n:"Matthew", img:"matt.jpg"}, {n:"Zack", img:"zack.jpg"}, {n:"Aliya", img:"aliya.jpg"}, {n:"Autumn", img:"autumn.jpg"}, {n:"Leo", img:"leo.jpg"}, {n:"Nova", img:"fnova.jpg"}, {n:"Paisley", img:"paisley.jpg"}, {n:"Olly", img:"olly.jpg"}, {n:"Lianne", img:"lianne.jpg"}, {n:"Zac", img:"zac.jpg"}, {n:"Maya", img:"fmaya.jpg"}, {n:"River", img:"river.jpg"}, {n:"Eitan", img:"eitan.jpg"}, {n:"Chloe", img:"chloe.jpg"}, {n:"Dr. Maria", img:"maria.jpg"}, {n:"Pani Stevens", img:"stevens.jpg"}, {n:"Peter", img:"peter.jpg"}, {n:"Sophie", img:"sophie.jpg"}, {n:"Joy", img:"joy.jpg"}, {n:"Daniel", img:"daniel.jpg"}, {n:"Henry", img:"henry.jpg"}, {n:"Julian", img:"julian.jpg"}, {n:"Ethan", img:"ethan.jpg"}, {n:"Sky", img:"sky.jpg"}],
        "NEXO KNIGHTS": [{n:"Clay Moorington", img:"clay.jpg"}, {n:"Macy Halbert", img:"macy.jpg"}, {n:"Aaron Fox", img:"aaron.jpg"}, {n:"Lance Richmond", img:"lance.jpg"}, {n:"Axl", img:"axl.jpg"}, {n:"Jestro", img:"jestro.jpg"}, {n:"Merlok 2.0", img:"merlok.jpg"}, {n:"Monstrox", img:"monstrox.jpg"}, {n:"Kr√≥l Halbert", img:"khalbert.jpg"}, {n:"Ava Prentis", img:"ava.jpg"}, {n:"Robin Underwood", img:"robinu.jpg"}, {n:"Lavaria", img:"lavaria.jpg"}, {n:"Moltor", img:"moltor.jpg"}, {n:"Flama", img:"flama.jpg"}, {n:"General Magmar", img:"magmar.jpg"}, {n:"Burnzie", img:"burnzie.jpg"}, {n:"Rogul", img:"rogul.jpg"}, {n:"Ruina", img:"ruina.jpg"}, {n:"Garg", img:"garg.jpg"}, {n:"Grimroc", img:"grimroc.jpg"}, {n:"Herc", img:"herc.jpg"}, {n:"Brick", img:"brick.jpg"}, {n:"Scurrier", img:"scurrier.jpg"}, {n:"Globlin", img:"globlin.jpg"}, {n:"Beast Master", img:"beast.jpg"}, {n:"Whiparella", img:"whip.jpg"}, {n:"Fluttermouth", img:"flutter.jpg"}, {n:"Quake Beast", img:"quake.jpg"}, {n:"Stone Stomper", img:"stomper.jpg"}, {n:"Lance Bot", img:"lbot.jpg"}],
        "BIONICLE": [{n:"Tahu", img:"tahu.jpg"}, {n:"Kopaka", img:"kopaka.jpg"}, {n:"Onua", img:"onua.jpg"}, {n:"Gali", img:"gali.jpg"}, {n:"Lewa", img:"lewa.jpg"}, {n:"Pohatu", img:"pohatu.jpg"}, {n:"Makuta", img:"makuta.jpg"}, {n:"Mata Nui", img:"matanui.jpg"}, {n:"Vakama", img:"vakama.jpg"}, {n:"Nokama", img:"nokama.jpg"}, {n:"Matau", img:"matau.jpg"}, {n:"Onewa", img:"onewa.jpg"}, {n:"Whenua", img:"whenua.jpg"}, {n:"Nuju", img:"nuju.jpg"}, {n:"Jaller", img:"jaller.jpg"}, {n:"Hahli", img:"hahli.jpg"}, {n:"Matoro", img:"matoro.jpg"}, {n:"Kongu", img:"kongu.jpg"}, {n:"Hewkii", img:"hewkii.jpg"}, {n:"Nuparu", img:"nuparu.jpg"}, {n:"Vezon", img:"vezon.jpg"}, {n:"Brutaka", img:"brutaka.jpg"}, {n:"Axonn", img:"axonn.jpg"}, {n:"Roodaka", img:"roodaka.jpg"}, {n:"Sidorak", img:"sidorak.jpg"}, {n:"Keetongu", img:"keetongu.jpg"}, {n:"Takadox", img:"takadox.jpg"}, {n:"Ehlek", img:"ehlek.jpg"}, {n:"Pridak", img:"pridak.jpg"}, {n:"Mantax", img:"mantax.jpg"}],
        "LORD OF THE RINGS": [{n:"Frodo Baggins", img:"frodo.jpg"}, {n:"Gandalf Szary", img:"gandalf.jpg"}, {n:"Aragorn", img:"aragorn.jpg"}, {n:"Legolas", img:"legolas.jpg"}, {n:"Gimli", img:"gimli.jpg"}, {n:"Samwise Gamgee", img:"sam.jpg"}, {n:"Boromir", img:"boromir.jpg"}, {n:"Gollum", img:"gollum.jpg"}, {n:"Sauron", img:"sauron.jpg"}, {n:"Saruman", img:"saruman.jpg"}, {n:"Pippin", img:"pippin.jpg"}, {n:"Merry", img:"merry.jpg"}, {n:"Arwena", img:"arwen.jpg"}, {n:"Elrond", img:"elrond.jpg"}, {n:"Galadriela", img:"galadriel.jpg"}, {n:"Eomer", img:"eomer.jpg"}, {n:"Theoden", img:"theoden.jpg"}, {n:"Eowina", img:"eowyn.jpg"}, {n:"Faramir", img:"faramir.jpg"}, {n:"Nazgul", img:"nazgul.jpg"}, {n:"Uruk-hai", img:"uruk.jpg"}, {n:"Orc Soldier", img:"orc.jpg"}, {n:"Bilbo Baggins", img:"bilbo.jpg"}, {n:"Radagast", img:"radagast.jpg"}, {n:"Tauriela", img:"tauriel.jpg"}, {n:"Bard", img:"bard.jpg"}, {n:"Thranduil", img:"thranduil.jpg"}, {n:"Balrog", img:"balrog.jpg"}, {n:"Witch King", img:"wking.jpg"}, {n:"Grima", img:"grima.jpg"}]
    };

    function toggleLanguage() {
        curL = (curL === 'pl') ? 'en' : 'pl';
        updateUI();
    }

    function updateUI() {
        const L = langData[curL];
        document.getElementById('lang-toggle').innerText = L.nextLang;
        document.getElementById('txt-title').innerText = L.title;
        document.getElementById('txt-host').innerText = L.host;
        document.getElementById('txt-join').innerText = L.join;
        document.getElementById('txt-inputCode').innerText = L.inputCode;
        document.getElementById('txt-connect').innerText = L.connect;
        document.getElementById('txt-back').innerText = L.back + " / Back";
        document.getElementById('txt-back2').innerText = L.back2;
        document.getElementById('txt-yourCode').innerText = L.yourCode;
        document.getElementById('txt-youAre').innerText = L.youAre;
        document.getElementById('txt-exit').innerText = L.exit;
        document.getElementById('txt-was').innerText = L.was;
        document.getElementById('txt-replay').innerText = L.replay;
        
        if(isHost && !document.getElementById('cat-list').classList.contains('hidden')) {
            document.getElementById('wait-msg').innerText = L.wait;
            renderCatList();
        }
    }

    function showS(id) {
        ['s-main', 's-join', 's-lobby', 's-game'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function goHost() {
        isHost = true;
        showS('s-lobby');
        const sid = Math.random().toString(36).substring(2, 8).toUpperCase();
        document.getElementById('room-display').innerText = sid;
        peer = new Peer(sid);
        peer.on('connection', c => {
            conn = c;
            document.getElementById('wait-msg').innerText = langData[curL].wait;
            document.getElementById('cat-list').classList.remove('hidden');
            renderCatList();
            setupConn();
        });
    }

    function renderCatList() {
        const list = document.getElementById('cat-list');
        list.innerHTML = `<button class="big-btn btn-mixed" onclick="hStart('MIXED')">${langData[curL].mixed}</button>`;
        Object.keys(db).forEach(cat => {
            const b = document.createElement('button');
            b.className = 'big-btn btn-blue';
            b.innerText = cat;
            b.onclick = () => hStart(cat);
            list.appendChild(b);
        });
    }

    function doJoin() {
        const id = document.getElementById('join-id').value.toUpperCase();
        if(!id) return;
        document.getElementById('txt-connect').innerText = langData[curL].alertWait;
        peer = new Peer();
        peer.on('open', () => {
            conn = peer.connect(id);
            setupConn();
        });
    }

    function setupConn() {
        conn.on('data', data => {
            if(data.type === 'START') { boardData = data.pool; myChar = data.yourChar; renderGame(); }
            if(data.type === 'GUESS') {
                if(confirm((curL === 'pl' ? "Przeciwnik pyta, czy masz postaƒá: " : "Opponent asks if you have: ") + data.name + "?")) {
                    if(data.name === myChar.n) {
                        conn.send({type: 'RESULT', status: 'WIN', char: myChar});
                        showFinalResult('LOSE', myChar);
                    } else alert(langData[curL].alertMiss);
                }
            }
            if(data.type === 'RESULT') showFinalResult(data.status, data.char);
        });
    }

    function hStart(cat) {
        let pool = [];
        if(cat === 'MIXED') {
            Object.values(db).forEach(v => pool = pool.concat(v));
        } else {
            pool = db[cat];
        }
        
        // Losowanie 30 unikalnych postaci
        let shuffled = pool.sort(() => 0.5 - Math.random()).slice(0, 30);
        const hChar = shuffled[Math.floor(Math.random()*30)];
        const gChar = shuffled[Math.floor(Math.random()*30)];
        
        conn.send({ type: 'START', pool: shuffled, yourChar: hChar });
        boardData = shuffled; myChar = gChar; 
        renderGame();
    }

    function renderGame() {
        showS('s-game');
        document.getElementById('my-char-name').innerText = myChar.n;
        const b = document.getElementById('game-board');
        b.innerHTML = '';
        boardData.forEach(p => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${IMG_BASE + p.img}" onerror="this.src='https://via.placeholder.com/150/ffd500/000000?text=LEGO'">
                <p>${p.n}</p>
                <button class="guess-btn" onclick="makeGuess('${p.n}', event)">${langData[curL].guess}</button>
            `;
            card.onclick = () => card.classList.toggle('eliminated');
            b.appendChild(card);
        });
        document.querySelectorAll('.guess-btn').forEach(btn => btn.innerText = langData[curL].guess);
    }

    function makeGuess(name, event) {
        event.stopPropagation();
        if(confirm(langData[curL].confirmG + name + "?")) {
            conn.send({type: 'GUESS', name: name});
        }
    }

    function showFinalResult(status, character) {
        const overlay = document.getElementById('result-overlay');
        overlay.classList.remove('hidden');
        document.getElementById('res-title').innerText = status === 'WIN' ? langData[curL].win : langData[curL].lose;
        document.getElementById('res-title').style.color = status === 'WIN' ? "#28a745" : "#da291c";
        document.getElementById('result-char-name').innerText = character.n;
        document.getElementById('result-img').src = IMG_BASE + character.img;
    }
    
    updateUI();
</script>
</body>
</html>
